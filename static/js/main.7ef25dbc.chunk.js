(this["webpackJsonpreact-chat-app"]=this["webpackJsonpreact-chat-app"]||[]).push([[0],{10:function(e,t,n){e.exports=n(27)},15:function(e,t,n){},16:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(8),s=n.n(r),c=(n(15),n(16),n(9)),i=n(1),m=n(2),l=n(4),u=n(3),d=n(5),h=function(e){var t=e.senderId,n=e.text;return a.a.createElement("div",{className:"message"},a.a.createElement("div",{className:"message-username"},t),a.a.createElement("div",{className:"message-text"},n.parts[0].payload.content))},p=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).messageListRef=a.a.createRef(),n}return Object(d.a)(t,e),Object(m.a)(t,[{key:"getSnapshotBeforeUpdate",value:function(e,t){var n=this.messageListRef.current;return this.shouldScrollToBottom=n.scrollTop+n.clientHeight+100>=n.scrollHeight,this.shouldScrollToBottom}},{key:"componentDidUpdate",value:function(e,t,n){if(n){var o=this.messageListRef.current;o.scrollTop=o.scrollHeight}}},{key:"render",value:function(){var e=this.props,t=e.messages,n=e.currentRoomId,o=t.map((function(e,t){return a.a.createElement(h,{senderId:e.senderId,text:e,key:e.id})}));return n?a.a.createElement("div",{className:"message-list",ref:this.messageListRef},o):a.a.createElement("div",{className:"message-list",ref:this.messageListRef},a.a.createElement("div",{className:"start-message"},"Click a room to start chatting"))}}]),t}(o.Component),f=function(e){var t=e.roomName,n=e.roomId,o=e.subscribeToRoom,r=e.currentRoomId===n?"active":"";return a.a.createElement("li",{className:"room ".concat(r)},a.a.createElement("button",{onClick:function(){return o(n)}},"# ",t))},g=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props,t=e.joinedRooms,n=e.joinableRooms,o=e.subscribeToRoom,r=e.currentRoomId,s=t.sort((function(e,t){return e.name.toUpperCase()<t.name.toUpperCase()?-1:1})).map((function(e){return a.a.createElement(f,{roomName:e.name,roomId:e.id,key:e.id,subscribeToRoom:o,currentRoomId:r})})),c=n.sort((function(e,t){return e.name.toUpperCase()<t.name.toUpperCase()?-1:1})).map((function(e){return a.a.createElement(f,{roomName:e.name,roomId:e.id,key:e.id,subscribeToRoom:o,currentRoomId:r})}));return a.a.createElement("div",{className:"rooms-list"},a.a.createElement("h3",null,"Your Rooms"),0===s.length?a.a.createElement("p",null,"Click to join rooms"):a.a.createElement("ul",null,s),a.a.createElement("h3",null,"Rooms to join"),0===c.length?a.a.createElement("p",null,"No new rooms yet"):a.a.createElement("ul",null,c))}}]),t}(o.Component),b=function(e){function t(){var e,n;Object(i.a)(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={roomName:""},n.handleChange=function(e){n.setState({roomName:e.target.value})},n.handleSubmit=function(e){e.preventDefault(),n.props.creatRoom(n.state.roomName),n.setState({roomName:""})},n}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"new-room-form"},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("input",{value:this.state.roomName,type:"text",placeholder:"Create a room",onChange:this.handleChange}),a.a.createElement("button",null,"+")))}}]),t}(o.Component),v=function(e){function t(){var e,n;Object(i.a)(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={message:""},n.handleChange=function(e){n.setState({message:e.target.value})},n.handleSubmit=function(e){var t=n.props.sendMessage;e.preventDefault(),t(n.state.message),n.setState({message:""})},n}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.currentRoomId;return a.a.createElement("div",{className:"send-message-form"},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("input",{disabled:e,type:"text",value:this.state.message,onChange:this.handleChange,placeholder:"Type message and hit enter"})))}}]),t}(o.Component),R=n(6),E=function(e){var t="online"===e.presence?"online":"offline";return a.a.createElement("div",{className:"indicator ".concat(t)})},j=function(e){var t=e.presence,n=e.name,o="online"===t?"(you)":"";return a.a.createElement("li",{className:"contact"},a.a.createElement(E,{presence:t}),a.a.createElement("img",{className:"avatar",src:"https://ui-avatars.com/api/?name=".concat(n,"&size=30&rounded=true"),alt:"avatar"}),"".concat(n," ").concat(o))},y=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.roomUsers.map((function(e){return a.a.createElement(j,{name:e.name,key:e.id,presence:e.presenceStore["".concat(e.id)]})}));return a.a.createElement("div",{className:"contacts-list"},a.a.createElement("h3",null,"Your Contacts"),a.a.createElement("ul",null,e),";")}}]),t}(o.Component),O=function(e){function t(){var e,n;Object(i.a)(this,t);for(var o=arguments.length,a=new Array(o),r=0;r<o;r++)a[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={messages:[],joinableRooms:[],joinedRooms:[],currentRoomId:null,roomUsers:[]},n.sendMessageToChatkit=function(e){n.currentUser.sendSimpleMessage({roomId:n.state.currentRoomId,text:e}).catch((function(e){console.log("Error: ".concat(e))})),n.currentUser.isTypingIn({roomId:n.state.currentRoomId}).then((function(){console.log("Success!",n.currentUser.name)})).catch((function(e){console.log("Error sending typing indicator: ".concat(e))}))},n.subscribeToRoom=function(e){n.setState({currentRoomId:e,messages:[]}),n.currentUser.subscribeToRoomMultipart({roomId:e,hooks:{onMessage:function(e){n.setState({messages:[].concat(Object(c.a)(n.state.messages),[e])}),console.log(e)},onPresenceChanged:function(e,t){console.log("User ".concat(t," ").concat(t.id," is ").concat(e.current))},onUserStartedTyping:function(e){console.log("User ".concat(e.name," started typing"))},onUserStoppedTyping:function(e){console.log("User ".concat(e.name," stopped typing"))}},messageLimit:20}).then((function(e){n.setState({currentRoomId:e.id,roomUsers:e.users}),n.getRooms()})).catch((function(e){return console.log("error on subscribing to room: ",e)}))},n.getRooms=function(){n.currentUser.getJoinableRooms().then((function(e){n.setState({joinableRooms:e,joinedRooms:n.currentUser.rooms})})).catch((function(e){console.log("Error getting joinable rooms: ".concat(e))}))},n.fetchRoomMessages=function(e){n.currentUser.fetchMultipartMessages({roomId:e,direction:"older"}).then((function(e){n.setState({messages:e})})).catch((function(e){console.log("Error fetching messages: ".concat(e))}))},n.creatRoom=function(e){n.currentUser.createRoom({name:e}).then((function(e){n.subscribeToRoom(e.id),console.log("Created room called ".concat(e.name))})).catch((function(e){console.log("Error creating room ".concat(e))}))},n}return Object(d.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("componentDidMount"),new R.ChatManager({instanceLocator:"v1:us1:700177bd-bd75-420e-9fe7-c47980afae0c",userId:"salma",tokenProvider:new R.TokenProvider({url:"https://us1.pusherplatform.io/services/chatkit_token_provider/v1/700177bd-bd75-420e-9fe7-c47980afae0c/token"})}).connect().then((function(t){e.currentUser=t,e.getRooms(),console.log("Successful connection",t.rooms)})).catch((function(e){console.log("Error on connection",e)}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"app"},a.a.createElement(p,{messages:this.state.messages,startMessage:this.state.startMessage,currentRoomId:this.state.currentRoomId}),a.a.createElement(g,{joinedRooms:this.state.joinedRooms,joinableRooms:this.state.joinableRooms,subscribeToRoom:this.subscribeToRoom,currentRoomId:this.state.currentRoomId}),a.a.createElement(y,{roomUsers:this.state.roomUsers}),a.a.createElement(b,{creatRoom:this.creatRoom}),a.a.createElement(v,{sendMessage:this.sendMessageToChatkit,currentRoomId:!this.state.currentRoomId}))}}]),t}(o.Component);var I=function(){return a.a.createElement(O,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[10,1,2]]]);
//# sourceMappingURL=main.7ef25dbc.chunk.js.map